{"version":3,"sources":["/Users/ankit/superinterface/packages/react/dist/server.cjs","../src/server.ts","../src/lib/runSteps/serializeRunStep.ts","../src/lib/messages/serializeMessage.ts","../src/lib/messages/messagesResponse/data/messages/index.ts","../src/lib/runSteps/getRunSteps/index.ts","../src/lib/messages/extendMessage.ts","../src/lib/messages/messagesResponse/data/messages/runMessages/index.ts","../src/lib/messages/messagesResponse/data/messages/runMessages/getLatestRun.ts","../src/lib/optimistic/optimisticId.ts","../src/lib/messages/messagesResponse/data/index.ts","../src/lib/messages/messagesResponse/limit.ts","../src/lib/messages/messagesResponse/hasNextPage.ts","../src/lib/messages/messagesResponse/index.ts","../src/lib/runs/serializeRun.ts","../src/lib/streams/enqueueJson.ts","../src/lib/messages/createMessageResponse/actionsStream.ts","../src/lib/messages/createMessageResponse/handleStream.ts","../src/lib/messages/createMessageResponse/index.ts"],"names":["__create","Object","create","__defProp","defineProperty","__getOwnPropDesc","getOwnPropertyDescriptor","__getOwnPropNames","getOwnPropertyNames","__getProtoOf","getPrototypeOf","__hasOwnProp","prototype","hasOwnProperty","__export","target","all","name","get","enumerable","__copyProps","to","from","except","desc","key","call","__toESM","mod","isNodeMode","__esModule","value","__toCommonJS","server_exports","createMessageResponse","extendMessage","messagesResponse","module","exports","import_radash","require","serializeRunStep","_ref","runStep","pick","serializeMessage","_message$runSteps","message","id","role","created_at","content","run_id","assistant_id","thread_id","attachments","metadata","runSteps","map","status","import_p_map","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","getRunSteps","_ref2","threadId","runId","client","runStepsResponse","beta","threads","runs","steps","list","data","_x","ownKeys","keys","getOwnPropertySymbols","filter","push","_objectSpread","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","_toPropertyKey","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","import_dayjs","getLatestRun","runsResponse","limit","optimisticId","concat","import_radash2","uid","progressStatuses","runMessages","result","latestRun","messageFromLatestRun","find","m","includes","dayjs","unix","object","incomplete_details","completed_at","incomplete_at","messages","pageParam","pMap","hasNextPage","after","lastId","body","last_id","serializeRun","run","import_radash3","enqueueJson","controller","enqueue","TextEncoder","encode","JSON","stringify","actionsStream","handleToolCall","toolCalls","required_action","Error","submit_tool_outputs","tool_calls","submitToolOutputsStream","import_p_map2","toolCall","tool_outputs","_asyncIterator","asyncIterator","iterator","AsyncFromSyncIterator","AsyncFromSyncIteratorContinuation","reject","s","next","return","_return","throw","_handleStream","stream","onEvent","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","err","event","console","dir","depth","handleStream","createRunStream","onStart","onError","onClose","ReadableStream","start","error","close"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __create = Object.create;\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __getProtoOf = Object.getPrototypeOf;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all)\n    __defProp(target, name, { get: all[name], enumerable: true });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from))\n      if (!__hasOwnProp.call(to, key) && key !== except)\n        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });\n  }\n  return to;\n};\nvar __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(\n  // If the importer is in node compatibility mode or this is not an ESM\n  // file that has been converted to a CommonJS file using a Babel-\n  // compatible transform (i.e. \"__esModule\" has not been set), then set\n  // \"default\" to the CommonJS \"module.exports\" for node compatibility.\n  isNodeMode || !mod || !mod.__esModule ? __defProp(target, \"default\", { value: mod, enumerable: true }) : target,\n  mod\n));\nvar __toCommonJS = (mod) => __copyProps(__defProp({}, \"__esModule\", { value: true }), mod);\n\n// src/server.ts\nvar server_exports = {};\n__export(server_exports, {\n  createMessageResponse: () => createMessageResponse,\n  extendMessage: () => extendMessage,\n  messagesResponse: () => messagesResponse\n});\nmodule.exports = __toCommonJS(server_exports);\n\n// src/lib/runSteps/serializeRunStep.ts\nvar import_radash = require(\"radash\");\nvar serializeRunStep = (_ref) => {\n  var {\n    runStep\n  } = _ref;\n  return (0, import_radash.pick)(runStep, [\"id\", \"run_id\", \"step_details\", \"completed_at\", \"cancelled_at\", \"failed_at\", \"status\"]);\n};\n\n// src/lib/messages/serializeMessage.ts\nvar serializeMessage = (_ref) => {\n  var _message$runSteps;\n  var {\n    message\n  } = _ref;\n  return {\n    id: message.id,\n    role: message.role,\n    created_at: message.created_at,\n    content: message.content,\n    run_id: message.run_id,\n    assistant_id: message.assistant_id,\n    thread_id: message.thread_id,\n    attachments: message.attachments,\n    metadata: message.metadata,\n    runSteps: ((_message$runSteps = message.runSteps) !== null && _message$runSteps !== void 0 ? _message$runSteps : []).map((runStep) => serializeRunStep({\n      runStep\n    })),\n    status: message.status\n  };\n};\n\n// src/lib/messages/messagesResponse/data/messages/index.ts\nvar import_p_map = __toESM(require(\"p-map\"), 1);\n\n// src/lib/runSteps/getRunSteps/index.ts\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar getRunSteps = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      threadId,\n      runId,\n      client\n    } = _ref;\n    var runStepsResponse = yield client.beta.threads.runs.steps.list(threadId, runId);\n    return runStepsResponse.data;\n  });\n  return function getRunSteps2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/extendMessage.ts\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function(r2) {\n      return Object.getOwnPropertyDescriptor(e, r2).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), true).forEach(function(r2) {\n      _defineProperty(e, r2, t[r2]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function(r2) {\n      Object.defineProperty(e, r2, Object.getOwnPropertyDescriptor(t, r2));\n    });\n  }\n  return e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: true, configurable: true, writable: true }) : e[r] = t, e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction asyncGeneratorStep2(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator2(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep2(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep2(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar extendMessage = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator2(function* (_ref) {\n    var {\n      message,\n      client\n    } = _ref;\n    if (!message.run_id) {\n      return _objectSpread(_objectSpread({}, message), {}, {\n        runSteps: []\n      });\n    }\n    return _objectSpread(_objectSpread({}, message), {}, {\n      runSteps: yield getRunSteps({\n        threadId: message.thread_id,\n        runId: message.run_id,\n        client\n      })\n    });\n  });\n  return function extendMessage2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/data/messages/runMessages/index.ts\nvar import_dayjs = __toESM(require(\"dayjs\"), 1);\n\n// src/lib/messages/messagesResponse/data/messages/runMessages/getLatestRun.ts\nfunction asyncGeneratorStep3(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator3(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep3(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep3(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar getLatestRun = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator3(function* (_ref) {\n    var {\n      threadId,\n      client\n    } = _ref;\n    var runsResponse = yield client.beta.threads.runs.list(threadId, {\n      limit: 1\n    });\n    return runsResponse.data[0];\n  });\n  return function getLatestRun2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/optimistic/optimisticId.ts\nvar import_radash2 = require(\"radash\");\nvar optimisticId = () => \"-\".concat((0, import_radash2.uid)(24));\n\n// src/lib/messages/messagesResponse/data/messages/runMessages/index.ts\nfunction asyncGeneratorStep4(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator4(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep4(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep4(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar progressStatuses = [\"queued\", \"in_progress\", \"requires_action\", \"cancelling\"];\nvar runMessages = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator4(function* (_ref) {\n    var {\n      result,\n      threadId,\n      client\n    } = _ref;\n    var latestRun = yield getLatestRun({\n      threadId,\n      client\n    });\n    if (!latestRun) {\n      return [];\n    }\n    var messageFromLatestRun = result.find((m) => m.run_id === latestRun.id);\n    if (messageFromLatestRun) {\n      return [];\n    }\n    if (!progressStatuses.includes(latestRun.status)) {\n      return [];\n    }\n    return [yield extendMessage({\n      message: {\n        id: optimisticId(),\n        role: \"assistant\",\n        created_at: (0, import_dayjs.default)().unix(),\n        object: \"thread.message\",\n        incomplete_details: null,\n        completed_at: (0, import_dayjs.default)().unix(),\n        incomplete_at: null,\n        status: \"completed\",\n        content: [],\n        run_id: latestRun.id,\n        assistant_id: latestRun.assistant_id,\n        thread_id: latestRun.thread_id,\n        attachments: [],\n        metadata: {}\n      },\n      client\n    })];\n  });\n  return function runMessages2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/data/messages/index.ts\nfunction asyncGeneratorStep5(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator5(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep5(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep5(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar messages = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator5(function* (_ref) {\n    var {\n      messagesResponse: messagesResponse2,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    var result = yield (0, import_p_map.default)(messagesResponse2.data, (message) => extendMessage({\n      client,\n      message\n    }));\n    if (pageParam) {\n      return result;\n    }\n    return [...yield runMessages({\n      result,\n      threadId,\n      client\n    }), ...result];\n  });\n  return function messages2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/data/index.ts\nfunction asyncGeneratorStep6(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator6(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep6(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep6(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar data = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator6(function* (_ref) {\n    var {\n      messagesResponse: messagesResponse2,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    return (yield messages({\n      messagesResponse: messagesResponse2,\n      pageParam,\n      threadId,\n      client\n    })).map((message) => serializeMessage({\n      message\n    }));\n  });\n  return function data2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/limit.ts\nvar limit = 10;\n\n// src/lib/messages/messagesResponse/hasNextPage.ts\nvar hasNextPage = (_ref) => {\n  var {\n    messagesResponse: messagesResponse2\n  } = _ref;\n  if (messagesResponse2.data.length < limit) return false;\n  return messagesResponse2.hasNextPage();\n};\n\n// src/lib/messages/messagesResponse/index.ts\nfunction ownKeys2(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function(r2) {\n      return Object.getOwnPropertyDescriptor(e, r2).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys2(Object(t), true).forEach(function(r2) {\n      _defineProperty2(e, r2, t[r2]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys2(Object(t)).forEach(function(r2) {\n      Object.defineProperty(e, r2, Object.getOwnPropertyDescriptor(t, r2));\n    });\n  }\n  return e;\n}\nfunction _defineProperty2(e, r, t) {\n  return (r = _toPropertyKey2(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: true, configurable: true, writable: true }) : e[r] = t, e;\n}\nfunction _toPropertyKey2(t) {\n  var i = _toPrimitive2(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _toPrimitive2(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction asyncGeneratorStep7(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator7(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep7(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep7(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar messagesResponse = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator7(function* (_ref) {\n    var {\n      client,\n      threadId,\n      pageParam\n    } = _ref;\n    var messagesResponse2 = yield client.beta.threads.messages.list(threadId, _objectSpread2(_objectSpread2({}, pageParam ? {\n      after: pageParam\n    } : {}), {}, {\n      limit\n    }));\n    return {\n      data: yield data({\n        client,\n        messagesResponse: messagesResponse2,\n        pageParam,\n        threadId\n      }),\n      hasNextPage: hasNextPage({\n        messagesResponse: messagesResponse2\n      }),\n      // @ts-ignore-next-line\n      lastId: messagesResponse2.body.last_id\n    };\n  });\n  return function messagesResponse2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/runs/serializeRun.ts\nvar import_radash3 = require(\"radash\");\nvar serializeRun = (_ref) => {\n  var {\n    run\n  } = _ref;\n  return (0, import_radash3.pick)(run, [\"id\", \"thread_id\", \"assistant_id\", \"created_at\"]);\n};\n\n// src/lib/streams/enqueueJson.ts\nvar enqueueJson = (_ref) => {\n  var {\n    controller,\n    value\n  } = _ref;\n  return controller.enqueue(new TextEncoder().encode(JSON.stringify(value)));\n};\n\n// src/lib/messages/createMessageResponse/actionsStream.ts\nvar import_p_map2 = __toESM(require(\"p-map\"), 1);\nfunction asyncGeneratorStep8(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator8(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep8(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep8(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar actionsStream = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator8(function* (_ref) {\n    var {\n      client,\n      run,\n      handleToolCall,\n      controller\n    } = _ref;\n    if (!run.required_action) {\n      throw new Error(\"Run does not have a required action\");\n    }\n    var toolCalls = run.required_action.submit_tool_outputs.tool_calls;\n    return client.beta.threads.runs.submitToolOutputsStream(run.thread_id, run.id, {\n      tool_outputs: yield (0, import_p_map2.default)(toolCalls, (toolCall) => handleToolCall({\n        toolCall,\n        run,\n        controller\n      }))\n    });\n  });\n  return function actionsStream2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/createMessageResponse/handleStream.ts\nfunction asyncGeneratorStep9(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator9(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep9(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep9(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nfunction _asyncIterator(r) {\n  var n, t, o, e = 2;\n  for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--; ) {\n    if (t && null != (n = r[t])) return n.call(r);\n    if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));\n    t = \"@@asyncIterator\", o = \"@@iterator\";\n  }\n  throw new TypeError(\"Object is not async iterable\");\n}\nfunction AsyncFromSyncIterator(r) {\n  function AsyncFromSyncIteratorContinuation(r2) {\n    if (Object(r2) !== r2) return Promise.reject(new TypeError(r2 + \" is not an object.\"));\n    var n = r2.done;\n    return Promise.resolve(r2.value).then(function(r3) {\n      return { value: r3, done: n };\n    });\n  }\n  return AsyncFromSyncIterator = function AsyncFromSyncIterator2(r2) {\n    this.s = r2, this.n = r2.next;\n  }, AsyncFromSyncIterator.prototype = { s: null, n: null, next: function next() {\n    return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n  }, return: function _return(r2) {\n    var n = this.s.return;\n    return void 0 === n ? Promise.resolve({ value: r2, done: true }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n  }, throw: function _throw(r2) {\n    var n = this.s.return;\n    return void 0 === n ? Promise.reject(r2) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n  } }, new AsyncFromSyncIterator(r);\n}\nvar _handleStream = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator9(function* (_ref) {\n    var {\n      client,\n      stream,\n      controller,\n      handleToolCall,\n      onEvent\n    } = _ref;\n    var _iteratorAbruptCompletion = false;\n    var _didIteratorError = false;\n    var _iteratorError;\n    try {\n      for (var _iterator = _asyncIterator(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n        var value = _step.value;\n        {\n          onEvent({\n            controller,\n            event: value.event,\n            data: value.data\n          });\n          if ([\"thread.message.created\", \"thread.message.completed\"].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeMessage({\n                  message: value.data\n                })\n              }\n            });\n          } else if ([\"thread.message.delta\", \"thread.run.step.delta\"].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value\n            });\n          } else if (value.event === \"thread.run.created\") {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if (value.event === \"thread.run.failed\") {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if ([\"thread.run.step.created\", \"thread.run.step.completed\"].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRunStep({\n                  runStep: value.data\n                })\n              }\n            });\n          } else if (value.event === \"thread.run.requires_action\") {\n            enqueueJson({\n              controller,\n              value\n            });\n            yield _handleStream({\n              client,\n              stream: yield actionsStream({\n                client,\n                run: value.data,\n                handleToolCall,\n                controller\n              }),\n              controller,\n              handleToolCall,\n              onEvent\n            });\n          } else {\n            console.dir({\n              value\n            }, {\n              depth: null\n            });\n          }\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (_iteratorAbruptCompletion && _iterator.return != null) {\n          yield _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  });\n  return function handleStream(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/createMessageResponse/index.ts\nfunction asyncGeneratorStep10(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator10(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep10(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep10(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar createMessageResponse = (_ref) => {\n  var {\n    client,\n    createRunStream,\n    handleToolCall,\n    onStart = () => {\n    },\n    onError = () => {\n    },\n    onClose = () => {\n    },\n    onEvent = () => {\n    }\n  } = _ref;\n  return new ReadableStream({\n    start(controller) {\n      return _asyncToGenerator10(function* () {\n        onStart({\n          controller\n        });\n        try {\n          yield _handleStream({\n            client,\n            stream: createRunStream,\n            controller,\n            handleToolCall,\n            onEvent\n          });\n        } catch (error) {\n          onError({\n            error,\n            controller\n          });\n          controller.error(error);\n        }\n        onClose({\n          controller\n        });\n        controller.close();\n      })();\n    }\n  });\n};\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  createMessageResponse,\n  extendMessage,\n  messagesResponse\n});\n","export { messagesResponse } from '@/lib/messages/messagesResponse';\nexport { createMessageResponse } from '@/lib/messages/createMessageResponse';\nexport { extendMessage } from '@/lib/messages/extendMessage';","import { pick } from 'radash';\nexport var serializeRunStep = _ref => {\n  var {\n    runStep\n  } = _ref;\n  return pick(runStep, ['id', 'run_id', 'step_details', 'completed_at', 'cancelled_at', 'failed_at', 'status']);\n};","import { serializeRunStep } from '@/lib/runSteps/serializeRunStep';\nexport var serializeMessage = _ref => {\n  var _message$runSteps;\n  var {\n    message\n  } = _ref;\n  return {\n    id: message.id,\n    role: message.role,\n    created_at: message.created_at,\n    content: message.content,\n    run_id: message.run_id,\n    assistant_id: message.assistant_id,\n    thread_id: message.thread_id,\n    attachments: message.attachments,\n    metadata: message.metadata,\n    runSteps: ((_message$runSteps = message.runSteps) !== null && _message$runSteps !== void 0 ? _message$runSteps : []).map(runStep => serializeRunStep({\n      runStep\n    })),\n    status: message.status\n  };\n};","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport pMap from 'p-map';\nimport { extendMessage } from '@/lib/messages/extendMessage';\nimport { runMessages } from './runMessages';\nexport var messages = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      messagesResponse,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    var result = yield pMap(messagesResponse.data, message => extendMessage({\n      client,\n      message\n    }));\n    if (pageParam) {\n      return result;\n    }\n    return [...(yield runMessages({\n      result,\n      threadId,\n      client\n    })), ...result];\n  });\n  return function messages(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nexport var getRunSteps = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      threadId,\n      runId,\n      client\n    } = _ref;\n    var runStepsResponse = yield client.beta.threads.runs.steps.list(threadId, runId);\n    return runStepsResponse.data;\n  });\n  return function getRunSteps(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { getRunSteps } from '@/lib/runSteps/getRunSteps';\nexport var extendMessage = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      message,\n      client\n    } = _ref;\n    if (!message.run_id) {\n      return _objectSpread(_objectSpread({}, message), {}, {\n        runSteps: []\n      });\n    }\n    return _objectSpread(_objectSpread({}, message), {}, {\n      runSteps: yield getRunSteps({\n        threadId: message.thread_id,\n        runId: message.run_id,\n        client\n      })\n    });\n  });\n  return function extendMessage(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport dayjs from 'dayjs';\nimport { getLatestRun } from './getLatestRun';\nimport { extendMessage } from '@/lib/messages/extendMessage';\nimport { optimisticId } from '@/lib/optimistic/optimisticId';\nvar progressStatuses = ['queued', 'in_progress', 'requires_action', 'cancelling'];\nexport var runMessages = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      result,\n      threadId,\n      client\n    } = _ref;\n    var latestRun = yield getLatestRun({\n      threadId,\n      client\n    });\n    if (!latestRun) {\n      return [];\n    }\n    var messageFromLatestRun = result.find(m => m.run_id === latestRun.id);\n    if (messageFromLatestRun) {\n      return [];\n    }\n    if (!progressStatuses.includes(latestRun.status)) {\n      return [];\n    }\n    return [yield extendMessage({\n      message: {\n        id: optimisticId(),\n        role: 'assistant',\n        created_at: dayjs().unix(),\n        object: 'thread.message',\n        incomplete_details: null,\n        completed_at: dayjs().unix(),\n        incomplete_at: null,\n        status: 'completed',\n        content: [],\n        run_id: latestRun.id,\n        assistant_id: latestRun.assistant_id,\n        thread_id: latestRun.thread_id,\n        attachments: [],\n        metadata: {}\n      },\n      client\n    })];\n  });\n  return function runMessages(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nexport var getLatestRun = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      threadId,\n      client\n    } = _ref;\n    var runsResponse = yield client.beta.threads.runs.list(threadId, {\n      limit: 1\n    });\n    return runsResponse.data[0];\n  });\n  return function getLatestRun(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","import { uid } from 'radash';\nexport var optimisticId = () => \"-\".concat(uid(24));","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { serializeMessage } from '@/lib/messages/serializeMessage';\nimport { messages } from './messages';\nexport var data = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      messagesResponse,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    return (yield messages({\n      messagesResponse,\n      pageParam,\n      threadId,\n      client\n    })).map(message => serializeMessage({\n      message\n    }));\n  });\n  return function data(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","export var limit = 10;","import { limit } from './limit';\nexport var hasNextPage = _ref => {\n  var {\n    messagesResponse\n  } = _ref;\n  if (messagesResponse.data.length < limit) return false;\n  return messagesResponse.hasNextPage();\n};","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { data } from './data';\nimport { limit } from './limit';\nimport { hasNextPage } from './hasNextPage';\nexport var messagesResponse = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      client,\n      threadId,\n      pageParam\n    } = _ref;\n    var messagesResponse = yield client.beta.threads.messages.list(threadId, _objectSpread(_objectSpread({}, pageParam ? {\n      after: pageParam\n    } : {}), {}, {\n      limit\n    }));\n    return {\n      data: yield data({\n        client,\n        messagesResponse,\n        pageParam,\n        threadId\n      }),\n      hasNextPage: hasNextPage({\n        messagesResponse\n      }),\n      // @ts-ignore-next-line\n      lastId: messagesResponse.body.last_id\n    };\n  });\n  return function messagesResponse(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","import { pick } from 'radash';\nexport var serializeRun = _ref => {\n  var {\n    run\n  } = _ref;\n  return pick(run, ['id', 'thread_id', 'assistant_id', 'created_at']);\n};","export var enqueueJson = _ref => {\n  var {\n    controller,\n    value\n  } = _ref;\n  return controller.enqueue(new TextEncoder().encode(JSON.stringify(value)));\n};","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport pMap from 'p-map';\nexport var actionsStream = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      client,\n      run,\n      handleToolCall,\n      controller\n    } = _ref;\n    if (!run.required_action) {\n      throw new Error('Run does not have a required action');\n    }\n    var toolCalls = run.required_action.submit_tool_outputs.tool_calls;\n    return client.beta.threads.runs.submitToolOutputsStream(run.thread_id, run.id, {\n      tool_outputs: yield pMap(toolCalls, toolCall => handleToolCall({\n        toolCall,\n        run,\n        controller\n      }))\n    });\n  });\n  return function actionsStream(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _asyncIterator(r) { var n, t, o, e = 2; for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) { if (t && null != (n = r[t])) return n.call(r); if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r)); t = \"@@asyncIterator\", o = \"@@iterator\"; } throw new TypeError(\"Object is not async iterable\"); }\nfunction AsyncFromSyncIterator(r) { function AsyncFromSyncIteratorContinuation(r) { if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\")); var n = r.done; return Promise.resolve(r.value).then(function (r) { return { value: r, done: n }; }); } return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) { this.s = r, this.n = r.next; }, AsyncFromSyncIterator.prototype = { s: null, n: null, next: function next() { return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments)); }, return: function _return(r) { var n = this.s.return; return void 0 === n ? Promise.resolve({ value: r, done: !0 }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments)); }, throw: function _throw(r) { var n = this.s.return; return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments)); } }, new AsyncFromSyncIterator(r); }\nimport { serializeMessage } from '@/lib/messages/serializeMessage';\nimport { serializeRun } from '@/lib/runs/serializeRun';\nimport { serializeRunStep } from '@/lib/runSteps/serializeRunStep';\nimport { enqueueJson } from '@/lib/streams/enqueueJson';\nimport { actionsStream } from './actionsStream';\nvar _handleStream = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      client,\n      stream,\n      controller,\n      handleToolCall,\n      onEvent\n    } = _ref;\n    // @ts-ignore-next-line\n    var _iteratorAbruptCompletion = false;\n    var _didIteratorError = false;\n    var _iteratorError;\n    try {\n      for (var _iterator = _asyncIterator(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n        var value = _step.value;\n        {\n          onEvent({\n            controller,\n            event: value.event,\n            data: value.data\n          });\n          if (['thread.message.created', 'thread.message.completed'].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeMessage({\n                  message: value.data\n                })\n              }\n            });\n          } else if (['thread.message.delta', 'thread.run.step.delta'].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value\n            });\n          } else if (value.event === 'thread.run.created') {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if (value.event === 'thread.run.failed') {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if (['thread.run.step.created', 'thread.run.step.completed'].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRunStep({\n                  runStep: value.data\n                })\n              }\n            });\n          } else if (value.event === 'thread.run.requires_action') {\n            enqueueJson({\n              controller,\n              value\n            });\n            yield _handleStream({\n              client,\n              stream: yield actionsStream({\n                client,\n                run: value.data,\n                handleToolCall,\n                controller\n              }),\n              controller,\n              handleToolCall,\n              onEvent\n            });\n          } else {\n            console.dir({\n              value\n            }, {\n              depth: null\n            });\n          }\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (_iteratorAbruptCompletion && _iterator.return != null) {\n          yield _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  });\n  return function handleStream(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport { _handleStream as handleStream };","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { handleStream } from './handleStream';\nexport var createMessageResponse = _ref => {\n  var {\n    client,\n    createRunStream,\n    handleToolCall,\n    onStart = () => {},\n    onError = () => {},\n    onClose = () => {},\n    onEvent = () => {}\n  } = _ref;\n  return new ReadableStream({\n    start(controller) {\n      return _asyncToGenerator(function* () {\n        onStart({\n          controller\n        });\n        try {\n          yield handleStream({\n            client,\n            stream: createRunStream,\n            controller,\n            handleToolCall,\n            onEvent\n          });\n        } catch (error) {\n          onError({\n            error,\n            controller\n          });\n          controller.error(error);\n        }\n        onClose({\n          controller\n        });\n        controller.close();\n      })();\n    }\n  });\n};"]}