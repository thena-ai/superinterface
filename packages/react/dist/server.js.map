{"version":3,"sources":["/Users/ankit/superinterface/packages/react/dist/server.js","../src/lib/runSteps/serializeRunStep.ts","../src/lib/messages/serializeMessage.ts","../src/lib/messages/messagesResponse/data/messages/index.ts","../src/lib/runSteps/getRunSteps/index.ts","../src/lib/messages/extendMessage.ts","../src/lib/messages/messagesResponse/data/messages/runMessages/index.ts","../src/lib/messages/messagesResponse/data/messages/runMessages/getLatestRun.ts","../src/lib/optimistic/optimisticId.ts","../src/lib/messages/messagesResponse/data/index.ts","../src/lib/messages/messagesResponse/limit.ts","../src/lib/messages/messagesResponse/hasNextPage.ts","../src/lib/messages/messagesResponse/index.ts","../src/lib/runs/serializeRun.ts","../src/lib/streams/enqueueJson.ts","../src/lib/messages/createMessageResponse/actionsStream.ts","../src/lib/messages/createMessageResponse/handleStream.ts","../src/lib/messages/createMessageResponse/index.ts"],"names":["pick","serializeRunStep","_ref","runStep","serializeMessage","_message$runSteps","message","id","role","created_at","content","run_id","assistant_id","thread_id","attachments","metadata","runSteps","map","status","pMap","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","getRunSteps","_ref2","threadId","runId","client","runStepsResponse","beta","threads","runs","steps","list","data","_x","ownKeys","Object","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","enumerable","push","_objectSpread","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","configurable","writable","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","extendMessage","dayjs","getLatestRun","runsResponse","limit","uid","optimisticId","concat","progressStatuses","runMessages","result","latestRun","messageFromLatestRun","find","m","includes","unix","object","incomplete_details","completed_at","incomplete_at","messages","messagesResponse","pageParam","hasNextPage","after","lastId","body","last_id","serializeRun","run","enqueueJson","controller","enqueue","TextEncoder","encode","JSON","stringify","actionsStream","handleToolCall","toolCalls","required_action","Error","submit_tool_outputs","tool_calls","submitToolOutputsStream","toolCall","tool_outputs","_asyncIterator","asyncIterator","iterator","AsyncFromSyncIterator","AsyncFromSyncIteratorContinuation","reject","s","next","prototype","return","_return","throw","_handleStream","stream","onEvent","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","err","event","console","dir","depth","handleStream","createMessageResponse","createRunStream","onStart","onError","onClose","ReadableStream","start","error","close"],"mappings":"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","sourcesContent":["// src/lib/runSteps/serializeRunStep.ts\nimport { pick } from \"radash\";\nvar serializeRunStep = (_ref) => {\n  var {\n    runStep\n  } = _ref;\n  return pick(runStep, [\"id\", \"run_id\", \"step_details\", \"completed_at\", \"cancelled_at\", \"failed_at\", \"status\"]);\n};\n\n// src/lib/messages/serializeMessage.ts\nvar serializeMessage = (_ref) => {\n  var _message$runSteps;\n  var {\n    message\n  } = _ref;\n  return {\n    id: message.id,\n    role: message.role,\n    created_at: message.created_at,\n    content: message.content,\n    run_id: message.run_id,\n    assistant_id: message.assistant_id,\n    thread_id: message.thread_id,\n    attachments: message.attachments,\n    metadata: message.metadata,\n    runSteps: ((_message$runSteps = message.runSteps) !== null && _message$runSteps !== void 0 ? _message$runSteps : []).map((runStep) => serializeRunStep({\n      runStep\n    })),\n    status: message.status\n  };\n};\n\n// src/lib/messages/messagesResponse/data/messages/index.ts\nimport pMap from \"p-map\";\n\n// src/lib/runSteps/getRunSteps/index.ts\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar getRunSteps = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      threadId,\n      runId,\n      client\n    } = _ref;\n    var runStepsResponse = yield client.beta.threads.runs.steps.list(threadId, runId);\n    return runStepsResponse.data;\n  });\n  return function getRunSteps2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/extendMessage.ts\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function(r2) {\n      return Object.getOwnPropertyDescriptor(e, r2).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), true).forEach(function(r2) {\n      _defineProperty(e, r2, t[r2]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function(r2) {\n      Object.defineProperty(e, r2, Object.getOwnPropertyDescriptor(t, r2));\n    });\n  }\n  return e;\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: true, configurable: true, writable: true }) : e[r] = t, e;\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction asyncGeneratorStep2(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator2(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep2(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep2(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar extendMessage = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator2(function* (_ref) {\n    var {\n      message,\n      client\n    } = _ref;\n    if (!message.run_id) {\n      return _objectSpread(_objectSpread({}, message), {}, {\n        runSteps: []\n      });\n    }\n    return _objectSpread(_objectSpread({}, message), {}, {\n      runSteps: yield getRunSteps({\n        threadId: message.thread_id,\n        runId: message.run_id,\n        client\n      })\n    });\n  });\n  return function extendMessage2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/data/messages/runMessages/index.ts\nimport dayjs from \"dayjs\";\n\n// src/lib/messages/messagesResponse/data/messages/runMessages/getLatestRun.ts\nfunction asyncGeneratorStep3(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator3(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep3(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep3(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar getLatestRun = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator3(function* (_ref) {\n    var {\n      threadId,\n      client\n    } = _ref;\n    var runsResponse = yield client.beta.threads.runs.list(threadId, {\n      limit: 1\n    });\n    return runsResponse.data[0];\n  });\n  return function getLatestRun2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/optimistic/optimisticId.ts\nimport { uid } from \"radash\";\nvar optimisticId = () => \"-\".concat(uid(24));\n\n// src/lib/messages/messagesResponse/data/messages/runMessages/index.ts\nfunction asyncGeneratorStep4(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator4(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep4(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep4(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar progressStatuses = [\"queued\", \"in_progress\", \"requires_action\", \"cancelling\"];\nvar runMessages = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator4(function* (_ref) {\n    var {\n      result,\n      threadId,\n      client\n    } = _ref;\n    var latestRun = yield getLatestRun({\n      threadId,\n      client\n    });\n    if (!latestRun) {\n      return [];\n    }\n    var messageFromLatestRun = result.find((m) => m.run_id === latestRun.id);\n    if (messageFromLatestRun) {\n      return [];\n    }\n    if (!progressStatuses.includes(latestRun.status)) {\n      return [];\n    }\n    return [yield extendMessage({\n      message: {\n        id: optimisticId(),\n        role: \"assistant\",\n        created_at: dayjs().unix(),\n        object: \"thread.message\",\n        incomplete_details: null,\n        completed_at: dayjs().unix(),\n        incomplete_at: null,\n        status: \"completed\",\n        content: [],\n        run_id: latestRun.id,\n        assistant_id: latestRun.assistant_id,\n        thread_id: latestRun.thread_id,\n        attachments: [],\n        metadata: {}\n      },\n      client\n    })];\n  });\n  return function runMessages2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/data/messages/index.ts\nfunction asyncGeneratorStep5(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator5(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep5(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep5(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar messages = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator5(function* (_ref) {\n    var {\n      messagesResponse: messagesResponse2,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    var result = yield pMap(messagesResponse2.data, (message) => extendMessage({\n      client,\n      message\n    }));\n    if (pageParam) {\n      return result;\n    }\n    return [...yield runMessages({\n      result,\n      threadId,\n      client\n    }), ...result];\n  });\n  return function messages2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/data/index.ts\nfunction asyncGeneratorStep6(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator6(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep6(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep6(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar data = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator6(function* (_ref) {\n    var {\n      messagesResponse: messagesResponse2,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    return (yield messages({\n      messagesResponse: messagesResponse2,\n      pageParam,\n      threadId,\n      client\n    })).map((message) => serializeMessage({\n      message\n    }));\n  });\n  return function data2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/messagesResponse/limit.ts\nvar limit = 10;\n\n// src/lib/messages/messagesResponse/hasNextPage.ts\nvar hasNextPage = (_ref) => {\n  var {\n    messagesResponse: messagesResponse2\n  } = _ref;\n  if (messagesResponse2.data.length < limit) return false;\n  return messagesResponse2.hasNextPage();\n};\n\n// src/lib/messages/messagesResponse/index.ts\nfunction ownKeys2(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function(r2) {\n      return Object.getOwnPropertyDescriptor(e, r2).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nfunction _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys2(Object(t), true).forEach(function(r2) {\n      _defineProperty2(e, r2, t[r2]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys2(Object(t)).forEach(function(r2) {\n      Object.defineProperty(e, r2, Object.getOwnPropertyDescriptor(t, r2));\n    });\n  }\n  return e;\n}\nfunction _defineProperty2(e, r, t) {\n  return (r = _toPropertyKey2(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: true, configurable: true, writable: true }) : e[r] = t, e;\n}\nfunction _toPropertyKey2(t) {\n  var i = _toPrimitive2(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _toPrimitive2(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r || \"default\");\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction asyncGeneratorStep7(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator7(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep7(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep7(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar messagesResponse = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator7(function* (_ref) {\n    var {\n      client,\n      threadId,\n      pageParam\n    } = _ref;\n    var messagesResponse2 = yield client.beta.threads.messages.list(threadId, _objectSpread2(_objectSpread2({}, pageParam ? {\n      after: pageParam\n    } : {}), {}, {\n      limit\n    }));\n    return {\n      data: yield data({\n        client,\n        messagesResponse: messagesResponse2,\n        pageParam,\n        threadId\n      }),\n      hasNextPage: hasNextPage({\n        messagesResponse: messagesResponse2\n      }),\n      // @ts-ignore-next-line\n      lastId: messagesResponse2.body.last_id\n    };\n  });\n  return function messagesResponse2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/runs/serializeRun.ts\nimport { pick as pick2 } from \"radash\";\nvar serializeRun = (_ref) => {\n  var {\n    run\n  } = _ref;\n  return pick2(run, [\"id\", \"thread_id\", \"assistant_id\", \"created_at\"]);\n};\n\n// src/lib/streams/enqueueJson.ts\nvar enqueueJson = (_ref) => {\n  var {\n    controller,\n    value\n  } = _ref;\n  return controller.enqueue(new TextEncoder().encode(JSON.stringify(value)));\n};\n\n// src/lib/messages/createMessageResponse/actionsStream.ts\nimport pMap2 from \"p-map\";\nfunction asyncGeneratorStep8(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator8(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep8(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep8(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar actionsStream = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator8(function* (_ref) {\n    var {\n      client,\n      run,\n      handleToolCall,\n      controller\n    } = _ref;\n    if (!run.required_action) {\n      throw new Error(\"Run does not have a required action\");\n    }\n    var toolCalls = run.required_action.submit_tool_outputs.tool_calls;\n    return client.beta.threads.runs.submitToolOutputsStream(run.thread_id, run.id, {\n      tool_outputs: yield pMap2(toolCalls, (toolCall) => handleToolCall({\n        toolCall,\n        run,\n        controller\n      }))\n    });\n  });\n  return function actionsStream2(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/createMessageResponse/handleStream.ts\nfunction asyncGeneratorStep9(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator9(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep9(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep9(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nfunction _asyncIterator(r) {\n  var n, t, o, e = 2;\n  for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--; ) {\n    if (t && null != (n = r[t])) return n.call(r);\n    if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));\n    t = \"@@asyncIterator\", o = \"@@iterator\";\n  }\n  throw new TypeError(\"Object is not async iterable\");\n}\nfunction AsyncFromSyncIterator(r) {\n  function AsyncFromSyncIteratorContinuation(r2) {\n    if (Object(r2) !== r2) return Promise.reject(new TypeError(r2 + \" is not an object.\"));\n    var n = r2.done;\n    return Promise.resolve(r2.value).then(function(r3) {\n      return { value: r3, done: n };\n    });\n  }\n  return AsyncFromSyncIterator = function AsyncFromSyncIterator2(r2) {\n    this.s = r2, this.n = r2.next;\n  }, AsyncFromSyncIterator.prototype = { s: null, n: null, next: function next() {\n    return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n  }, return: function _return(r2) {\n    var n = this.s.return;\n    return void 0 === n ? Promise.resolve({ value: r2, done: true }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n  }, throw: function _throw(r2) {\n    var n = this.s.return;\n    return void 0 === n ? Promise.reject(r2) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n  } }, new AsyncFromSyncIterator(r);\n}\nvar _handleStream = /* @__PURE__ */ function() {\n  var _ref2 = _asyncToGenerator9(function* (_ref) {\n    var {\n      client,\n      stream,\n      controller,\n      handleToolCall,\n      onEvent\n    } = _ref;\n    var _iteratorAbruptCompletion = false;\n    var _didIteratorError = false;\n    var _iteratorError;\n    try {\n      for (var _iterator = _asyncIterator(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n        var value = _step.value;\n        {\n          onEvent({\n            controller,\n            event: value.event,\n            data: value.data\n          });\n          if ([\"thread.message.created\", \"thread.message.completed\"].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeMessage({\n                  message: value.data\n                })\n              }\n            });\n          } else if ([\"thread.message.delta\", \"thread.run.step.delta\"].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value\n            });\n          } else if (value.event === \"thread.run.created\") {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if (value.event === \"thread.run.failed\") {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if ([\"thread.run.step.created\", \"thread.run.step.completed\"].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRunStep({\n                  runStep: value.data\n                })\n              }\n            });\n          } else if (value.event === \"thread.run.requires_action\") {\n            enqueueJson({\n              controller,\n              value\n            });\n            yield _handleStream({\n              client,\n              stream: yield actionsStream({\n                client,\n                run: value.data,\n                handleToolCall,\n                controller\n              }),\n              controller,\n              handleToolCall,\n              onEvent\n            });\n          } else {\n            console.dir({\n              value\n            }, {\n              depth: null\n            });\n          }\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (_iteratorAbruptCompletion && _iterator.return != null) {\n          yield _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  });\n  return function handleStream(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\n// src/lib/messages/createMessageResponse/index.ts\nfunction asyncGeneratorStep10(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c), u = i.value;\n  } catch (n2) {\n    return void e(n2);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator10(n) {\n  return function() {\n    var t = this, e = arguments;\n    return new Promise(function(r, o) {\n      var a = n.apply(t, e);\n      function _next(n2) {\n        asyncGeneratorStep10(a, r, o, _next, _throw, \"next\", n2);\n      }\n      function _throw(n2) {\n        asyncGeneratorStep10(a, r, o, _next, _throw, \"throw\", n2);\n      }\n      _next(void 0);\n    });\n  };\n}\nvar createMessageResponse = (_ref) => {\n  var {\n    client,\n    createRunStream,\n    handleToolCall,\n    onStart = () => {\n    },\n    onError = () => {\n    },\n    onClose = () => {\n    },\n    onEvent = () => {\n    }\n  } = _ref;\n  return new ReadableStream({\n    start(controller) {\n      return _asyncToGenerator10(function* () {\n        onStart({\n          controller\n        });\n        try {\n          yield _handleStream({\n            client,\n            stream: createRunStream,\n            controller,\n            handleToolCall,\n            onEvent\n          });\n        } catch (error) {\n          onError({\n            error,\n            controller\n          });\n          controller.error(error);\n        }\n        onClose({\n          controller\n        });\n        controller.close();\n      })();\n    }\n  });\n};\nexport {\n  createMessageResponse,\n  extendMessage,\n  messagesResponse\n};\n","import { pick } from 'radash';\nexport var serializeRunStep = _ref => {\n  var {\n    runStep\n  } = _ref;\n  return pick(runStep, ['id', 'run_id', 'step_details', 'completed_at', 'cancelled_at', 'failed_at', 'status']);\n};","import { serializeRunStep } from '@/lib/runSteps/serializeRunStep';\nexport var serializeMessage = _ref => {\n  var _message$runSteps;\n  var {\n    message\n  } = _ref;\n  return {\n    id: message.id,\n    role: message.role,\n    created_at: message.created_at,\n    content: message.content,\n    run_id: message.run_id,\n    assistant_id: message.assistant_id,\n    thread_id: message.thread_id,\n    attachments: message.attachments,\n    metadata: message.metadata,\n    runSteps: ((_message$runSteps = message.runSteps) !== null && _message$runSteps !== void 0 ? _message$runSteps : []).map(runStep => serializeRunStep({\n      runStep\n    })),\n    status: message.status\n  };\n};","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport pMap from 'p-map';\nimport { extendMessage } from '@/lib/messages/extendMessage';\nimport { runMessages } from './runMessages';\nexport var messages = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      messagesResponse,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    var result = yield pMap(messagesResponse.data, message => extendMessage({\n      client,\n      message\n    }));\n    if (pageParam) {\n      return result;\n    }\n    return [...(yield runMessages({\n      result,\n      threadId,\n      client\n    })), ...result];\n  });\n  return function messages(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nexport var getRunSteps = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      threadId,\n      runId,\n      client\n    } = _ref;\n    var runStepsResponse = yield client.beta.threads.runs.steps.list(threadId, runId);\n    return runStepsResponse.data;\n  });\n  return function getRunSteps(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { getRunSteps } from '@/lib/runSteps/getRunSteps';\nexport var extendMessage = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      message,\n      client\n    } = _ref;\n    if (!message.run_id) {\n      return _objectSpread(_objectSpread({}, message), {}, {\n        runSteps: []\n      });\n    }\n    return _objectSpread(_objectSpread({}, message), {}, {\n      runSteps: yield getRunSteps({\n        threadId: message.thread_id,\n        runId: message.run_id,\n        client\n      })\n    });\n  });\n  return function extendMessage(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport dayjs from 'dayjs';\nimport { getLatestRun } from './getLatestRun';\nimport { extendMessage } from '@/lib/messages/extendMessage';\nimport { optimisticId } from '@/lib/optimistic/optimisticId';\nvar progressStatuses = ['queued', 'in_progress', 'requires_action', 'cancelling'];\nexport var runMessages = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      result,\n      threadId,\n      client\n    } = _ref;\n    var latestRun = yield getLatestRun({\n      threadId,\n      client\n    });\n    if (!latestRun) {\n      return [];\n    }\n    var messageFromLatestRun = result.find(m => m.run_id === latestRun.id);\n    if (messageFromLatestRun) {\n      return [];\n    }\n    if (!progressStatuses.includes(latestRun.status)) {\n      return [];\n    }\n    return [yield extendMessage({\n      message: {\n        id: optimisticId(),\n        role: 'assistant',\n        created_at: dayjs().unix(),\n        object: 'thread.message',\n        incomplete_details: null,\n        completed_at: dayjs().unix(),\n        incomplete_at: null,\n        status: 'completed',\n        content: [],\n        run_id: latestRun.id,\n        assistant_id: latestRun.assistant_id,\n        thread_id: latestRun.thread_id,\n        attachments: [],\n        metadata: {}\n      },\n      client\n    })];\n  });\n  return function runMessages(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nexport var getLatestRun = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      threadId,\n      client\n    } = _ref;\n    var runsResponse = yield client.beta.threads.runs.list(threadId, {\n      limit: 1\n    });\n    return runsResponse.data[0];\n  });\n  return function getLatestRun(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","import { uid } from 'radash';\nexport var optimisticId = () => \"-\".concat(uid(24));","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { serializeMessage } from '@/lib/messages/serializeMessage';\nimport { messages } from './messages';\nexport var data = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      messagesResponse,\n      pageParam,\n      threadId,\n      client\n    } = _ref;\n    return (yield messages({\n      messagesResponse,\n      pageParam,\n      threadId,\n      client\n    })).map(message => serializeMessage({\n      message\n    }));\n  });\n  return function data(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","export var limit = 10;","import { limit } from './limit';\nexport var hasNextPage = _ref => {\n  var {\n    messagesResponse\n  } = _ref;\n  if (messagesResponse.data.length < limit) return false;\n  return messagesResponse.hasNextPage();\n};","function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { data } from './data';\nimport { limit } from './limit';\nimport { hasNextPage } from './hasNextPage';\nexport var messagesResponse = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      client,\n      threadId,\n      pageParam\n    } = _ref;\n    var messagesResponse = yield client.beta.threads.messages.list(threadId, _objectSpread(_objectSpread({}, pageParam ? {\n      after: pageParam\n    } : {}), {}, {\n      limit\n    }));\n    return {\n      data: yield data({\n        client,\n        messagesResponse,\n        pageParam,\n        threadId\n      }),\n      hasNextPage: hasNextPage({\n        messagesResponse\n      }),\n      // @ts-ignore-next-line\n      lastId: messagesResponse.body.last_id\n    };\n  });\n  return function messagesResponse(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","import { pick } from 'radash';\nexport var serializeRun = _ref => {\n  var {\n    run\n  } = _ref;\n  return pick(run, ['id', 'thread_id', 'assistant_id', 'created_at']);\n};","export var enqueueJson = _ref => {\n  var {\n    controller,\n    value\n  } = _ref;\n  return controller.enqueue(new TextEncoder().encode(JSON.stringify(value)));\n};","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport pMap from 'p-map';\nexport var actionsStream = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      client,\n      run,\n      handleToolCall,\n      controller\n    } = _ref;\n    if (!run.required_action) {\n      throw new Error('Run does not have a required action');\n    }\n    var toolCalls = run.required_action.submit_tool_outputs.tool_calls;\n    return client.beta.threads.runs.submitToolOutputsStream(run.thread_id, run.id, {\n      tool_outputs: yield pMap(toolCalls, toolCall => handleToolCall({\n        toolCall,\n        run,\n        controller\n      }))\n    });\n  });\n  return function actionsStream(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction _asyncIterator(r) { var n, t, o, e = 2; for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) { if (t && null != (n = r[t])) return n.call(r); if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r)); t = \"@@asyncIterator\", o = \"@@iterator\"; } throw new TypeError(\"Object is not async iterable\"); }\nfunction AsyncFromSyncIterator(r) { function AsyncFromSyncIteratorContinuation(r) { if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\")); var n = r.done; return Promise.resolve(r.value).then(function (r) { return { value: r, done: n }; }); } return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) { this.s = r, this.n = r.next; }, AsyncFromSyncIterator.prototype = { s: null, n: null, next: function next() { return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments)); }, return: function _return(r) { var n = this.s.return; return void 0 === n ? Promise.resolve({ value: r, done: !0 }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments)); }, throw: function _throw(r) { var n = this.s.return; return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments)); } }, new AsyncFromSyncIterator(r); }\nimport { serializeMessage } from '@/lib/messages/serializeMessage';\nimport { serializeRun } from '@/lib/runs/serializeRun';\nimport { serializeRunStep } from '@/lib/runSteps/serializeRunStep';\nimport { enqueueJson } from '@/lib/streams/enqueueJson';\nimport { actionsStream } from './actionsStream';\nvar _handleStream = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator(function* (_ref) {\n    var {\n      client,\n      stream,\n      controller,\n      handleToolCall,\n      onEvent\n    } = _ref;\n    // @ts-ignore-next-line\n    var _iteratorAbruptCompletion = false;\n    var _didIteratorError = false;\n    var _iteratorError;\n    try {\n      for (var _iterator = _asyncIterator(stream), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n        var value = _step.value;\n        {\n          onEvent({\n            controller,\n            event: value.event,\n            data: value.data\n          });\n          if (['thread.message.created', 'thread.message.completed'].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeMessage({\n                  message: value.data\n                })\n              }\n            });\n          } else if (['thread.message.delta', 'thread.run.step.delta'].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value\n            });\n          } else if (value.event === 'thread.run.created') {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if (value.event === 'thread.run.failed') {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRun({\n                  run: value.data\n                })\n              }\n            });\n          } else if (['thread.run.step.created', 'thread.run.step.completed'].includes(value.event)) {\n            enqueueJson({\n              controller,\n              value: {\n                event: value.event,\n                data: serializeRunStep({\n                  runStep: value.data\n                })\n              }\n            });\n          } else if (value.event === 'thread.run.requires_action') {\n            enqueueJson({\n              controller,\n              value\n            });\n            yield _handleStream({\n              client,\n              stream: yield actionsStream({\n                client,\n                run: value.data,\n                handleToolCall,\n                controller\n              }),\n              controller,\n              handleToolCall,\n              onEvent\n            });\n          } else {\n            console.dir({\n              value\n            }, {\n              depth: null\n            });\n          }\n        }\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (_iteratorAbruptCompletion && _iterator.return != null) {\n          yield _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n  });\n  return function handleStream(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport { _handleStream as handleStream };","function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nimport { handleStream } from './handleStream';\nexport var createMessageResponse = _ref => {\n  var {\n    client,\n    createRunStream,\n    handleToolCall,\n    onStart = () => {},\n    onError = () => {},\n    onClose = () => {},\n    onEvent = () => {}\n  } = _ref;\n  return new ReadableStream({\n    start(controller) {\n      return _asyncToGenerator(function* () {\n        onStart({\n          controller\n        });\n        try {\n          yield handleStream({\n            client,\n            stream: createRunStream,\n            controller,\n            handleToolCall,\n            onEvent\n          });\n        } catch (error) {\n          onError({\n            error,\n            controller\n          });\n          controller.error(error);\n        }\n        onClose({\n          controller\n        });\n        controller.close();\n      })();\n    }\n  });\n};"]}